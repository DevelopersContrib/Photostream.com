<?php include('IXR_Library.inc.php'); class DB extends IXR_Server{  var $link;  var $result; function DB() {                    $this->IXR_Server(array(                    'connect'           	=> 'this:connect',                    'connect3'           	=> 'this:connect3',                    'query'             	=> 'this:query',                    'mytables'            => 'this:mytables',                    'disconnect'	        => 'this:disconnect',                    'result'           		=> 'this:result',                    'GetUser'             => 'this:GetUser',                    'GetUserName'         => 'this:GetUserName',                    'GetUserInfo'         => 'this:GetUserInfo',                    'GetCountUser'        => 'this:GetCountUser',                    'GetImagesUser'       => 'this:GetImagesUser',                    'GetParentChild'      => 'this:GetParentChild',                    'GetEntity'           => 'this:GetEntity',                    'GetVideosUser'       => 'this:GetVideosUser',                    'GetUserRank'         => 'this:GetUserRank',                    'GetWebpoints'        => 'this:GetWebpoints',                    'GetUserId'           => 'this:GetUserId',                    'GetUserData'         => 'this:GetUserData',                    'TopWebpointers'      => 'this:TopWebpointers',                    'GetCommunities'      => 'this:GetCommunities',                    'GetOwnedCom'         => 'this:GetOwnedCom',                    'GetBlogsUser'        => 'this:GetBlogsUser',                    'AddBlogs'            => 'this:AddBlogs',                    'GetPopularImages'    => 'this:GetPopularImages',                    'GetComMembers'       => 'this:GetComMembers',                    'GetTags'             => 'this:GetTags',                    'GetDateJoined'       => 'this:GetDateJoined',                    'GetComMembers2'      => 'this:GetComMembers2',                    'GetFeedsByUser'      => 'this:GetFeedsByUser',                    'GetFeedsByTopicUser' => 'this:GetFeedsByTopicUser',                    'GetMainCategory'     => 'this:GetMainCategory',                    'GetSubCategory'      => 'this:GetSubCategory',                    'GetProfLinksByCat'   => 'this:GetProfLinksByCat',                    'GetFeedsByTopic'     => 'this:GetFeedsByTopic',                    'GetImagesKeyword'    => 'this:GetImagesKeyword',                    'GetBlogsKeyword'     => 'this:GetBlogsKeyword',                    'GetVideosPopular'    => 'this:GetVideosPopular',                    'GetMusicUser'        => 'this:GetMusicUser',                    'GetMusicLatest'      => 'this:GetMusicLatest',                    'GetVideosKeyword'    => 'this:GetVideosKeyword',                    'GetBlogsLatest'      => 'this:GetBlogsLatest',                    'GetMusicKeyword'     => 'this:GetMusicKeyword',                    'GetBlogsUp'          => 'this:GetBlogsUp',                    'GetBlogsDown'        => 'this:GetBlogsDown',                    'GetBlogsPopular'     => 'this:GetBlogsPopular',                    'GetBookmarksLatest'  => 'this:GetBookmarksLatest',                    'GetBookmarksPopular' => 'this:GetBookmarksPopular',                    'GetBookmarksKeyword' => 'this:GetBookmarksKeyword',                    'GetBookmarksUser'    => 'this:GetBookmarksUser',                    'GetLatestSurvey'     => 'this:GetLatestSurvey',                    'GetKeywordSurvey'    => 'this:GetKeywordSurvey',                    'GetUserSurvey'       => 'this:GetUserSurvey',                    'GetLatestUsers'      => 'this:GetLatestUsers',                    'GetUsersByCat'       => 'this:GetUsersByCat',                    'GetUsersByKeyword'   => 'this:GetUsersByKeyword',                    'GetMusicPopular'     => 'this:GetMusicPopular',                    'GetLatestRooms'      => 'this:GetLatestRooms',                    'GetMappers'          => 'this:GetMappers',                    'GetPortalTheme'      => 'this:GetPortalTheme',                    'LogInStatus'         => 'this:LogInStatus',                    'GetComShout'         => 'this:GetComShout',                    'GetConvertDate'      => 'this:GetConvertDate',                    'GetPathName'         => 'this:GetPathName',                    'GetProjectsOwn'      => 'this:GetProjectsOwn',                    'GetProjectsLatest'   => 'this:GetProjectsLatest',                    'GetProjectsPop'      => 'this:GetProjectsPop',                    'GetBlogsById'        => 'this:GetBlogsById',                    'EditBlog'            => 'this:EditBlog',                    'DeleteBlog'          => 'this:DeleteBlog',                    'AddBookmarks'        => 'this:AddBookmarks',                    'EditBookmark'        => 'this:EditBookmark',                    'DeleteBookmark'      => 'this:DeleteBookmark',                    'EditProfileData'     => 'this:EditProfileData',                    'CountRecord'         => 'this:CountRecord',                    'AddProfileData'      => 'this:AddProfileData',                    'GetBookmarksById'    => 'this:GetBookmarksById',                    'AddFeeds'            => 'this:AddFeeds',                    'AddForums'           => 'this:AddForums',                    'EditForums'          => 'this:EditForums',                    'GetForumsByUser'     => 'this:GetForumsByUser',                    'GetForumsById'       => 'this:GetForumsById',                    'DeleteForum'         => 'this:DeleteForum',                    'GetCommentForum'     => 'this:GetCommentForum',                    'DeleteForumComments' => 'this:DeleteForumComments',                    'AddProjects'         => 'this:AddProjects',                    'GetProjectCategories'=> 'this:GetProjectCategories',                    'GetProjectsById'     => 'this:GetProjectsById',                    'EditProjects'        => 'this:EditProjects',                    'DeleteProjects'      => 'this:DeleteProjects',                    'GetProjReview'       => 'this:GetProjReview',                    'DeleteProjReview'    => 'this:DeleteProjReview',                    'GetProjPhotos'       => 'this:GetProjPhotos',                    'AddProjPhoto'        => 'this:AddProjPhoto',                    'DeleteProjPhoto'     => 'this:DeleteProjPhoto',                    'GetEventsLatest'     => 'this:GetEventsLatest',                    'GetEventsUser'       => 'this:GetEventsUser',                    'AddEvents'           => 'this:AddEvents',                    'GetEventsById'       => 'this:GetEventsById',                    'EditEvents'          => 'this:EditEvents',                    'DeleteEvent'         => 'this:DeleteEvent',                    'GetPlacesLatest'     => 'this:GetPlacesLatest',                    'GetPlacesByUser'     => 'this:GetPlacesByUser',                    'GetPlaceCategories'  => 'this:GetPlaceCategories',                    'GetPlaceCountries'   => 'this:GetPlaceCountries',                    'AddPlaces'           => 'this:AddPlaces',                    'EditPlaces'          => 'this:EditPlaces',                    'GetPlacesById'       => 'this:GetPlacesById',                    'AddPlacePhoto'       => 'this:AddPlacePhoto',                    'GetPlacePhotos'      => 'this:GetPlacePhotos',                    'DeletePlace'         => 'this:DeletePlace',                    'DeletePlacePhoto'    => 'this:DeletePlacePhoto',                    'GetPlacesReview'     => 'this:GetPlacesReview',                    'DeletePlaceReview'   => 'this:DeletePlaceReview',                    'GetShopLatest'       => 'this:GetShopLatest',                    'GetShopLatestStores' => 'this:GetShopLatestStores',                    'RegMpUser'           => 'this:RegMpUser',                    'UpdateWebpoints'     => 'this:UpdateWebpoints'                                        ));  }function connect($user='mpnet_maida',$passwd='bing2k',$host="localhost",$db='mpnet_mypage'){        $this->link = mysql_connect($host,$user,$passwd) or die(mysql_error());	 mysql_select_db($db) or die(mysql_error());  }function connect2($user='mpnet_maida',$passwd='bing2k',$host="localhost",$db='mpnet_3pmapr'){        $this->link = mysql_connect($host,$user,$passwd) or die(mysql_error());	 mysql_select_db($db) or die(mysql_error());  } function connect3($user='kareen',$passwd='kareen4,',$host="121.97.203.50",$db='kareen_mypagetxt'){        $this->link = mysql_connect($host,$user,$passwd) or die(mysql_error());	 mysql_select_db($db) or die(mysql_error());  } function query($query){ 	$this->result = mysql_query($query) or die(mysql_error()); } function mytables($dbname){ 	$this->result = mysql_list_tables($dbname) or die(mysql_error()); }  function result(){ 	return $this->result; } function clean(){	 	mysql_free_result($this->result); } function disconnect(){	 	mysql_close($this->link); } //Get userid name and email input should be username and password function GetUser($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,name,email,icon from elggusers  where  username = \"{$args[0]}\" and                      password =  \"{$args[1]}\"";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->userid = $row[0];   $list[$i]->name =   $row[1];	 $list[$i]->email = $row[2];	 $list[$i]->icon  = $row[3];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; }//Function: Gets the username of mypage user//Parameter: id of the user function GetUserName($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select username,icon from `elggusers`  where  ident = $args";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->username = $row[0];   $list[$i]->icon =   $row[1];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; }//Function: Gets the user profile info such as://user info values : aim, biography,country,emailaddress,goals,industry,jobdescription,jobtitle,minibio,//msn,occupation,organisation,postcode,profilephoto,skills,state,streetaddress,town,yahoo//Parameter: id of the user and user info value function GetUserInfo($args) {   $this->connect();   $query = "SELECT value FROM `elggprofile_data` WHERE `owner` = $args[0] and name LIKE \"{$args[1]}\"";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $value = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $value; } function GetCountUser($args) {   $this->connect();   $query = "SELECT Count(*) as count from elggusers where user_type=\"{$args}\" and active=\"yes\"";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $numcount = $row[0];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $numcount; }//get images from gallery function GetImagesUser($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description            FROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_userName LIKE \"{$args[0]}\" AND g_entityType = \"GalleryPhotoItem\" ORDER BY `g3_Item`.g_id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetParentChild($args){   $i=0;   $list = array();   $this->connect();   $query = " SELECT g_id FROM `g3_ChildEntity`  WHERE `g_parentId` = {$args} LIMIT 1";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetEntity($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT g_serialNumber FROM `g3_Entity` WHERE `g_id` = {$args}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->serial = $row[0];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}//get images from gallery function GetVideosUser($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_userName LIKE \"{$args[0]}\" AND g_entityType = \"GalleryMovieItem\" ORDER BY `g3_Item`.g_id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->path = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetUserRank($args) {    $i=0;   $list = array();   $this->connect();   $query = "SELECT username," .$args[0]. " as value from `elggwebpoints`  where user_type=\"{$args[1]}\" group by username order by " .$args[0]. "  DESC LIMIT " .$args[2];     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	$list[$i]->username = $row[0];    $list[$i]->value = $row[1];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetWebpoints($args) {    $i=0;   $list = array();   $this->connect();   $query = "SELECT up_image,up_music,up_video,blog_entry,users_num,links_num,views,forum_post from elggwebpoints where username = \"{$args}\" ";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	$list[$i]->image = $row[0];    $list[$i]->music = $row[1];    $list[$i]->video = $row[2];    $list[$i]->blog = $row[3];    $list[$i]->friends = $row[4];    $list[$i]->bookmarks = $row[5];    $list[$i]->views = $row[6];    $list[$i]->forums = $row[7];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }//Get user info function GetUserId($args) {   $this->connect();   $query = "SELECT ident from elggusers where username LIKE \"{$args}\" ";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $ident = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $ident; }function GetUserData($args) {   $this->connect();   $query = "Select ".$args[0]." as field from elggusers where ident = {$args[1]}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $field  = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $field; }function TopWebpointers($args){   $i=0;   $list = array();    $this->connect();   $query = "SELECT username, (up_image+up_music+up_video+blog_entry+users_num+links_num+views) as total  FROM `elggwebpoints` where user_type = \"{$args[0]}\" group by username  order by total DESC LIMIT $args[1]";   $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->username = $row[0];	 	 $list[$i]->total = $row[1];   	$i++;	 	 }	 $this->clean();	 $this->disconnect();	 return $list;}function GetCommunities($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT elggusers.ident,username,name,icon from elggusers,elggfriends where elggfriends.friend = elggusers.ident   and elggfriends.owner=$args and elggusers.user_type=\"community\"";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->userid = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->name = $row[2];	 	 $list[$i]->icon = "http://www.mypage.com/_icon/user/".$row[3];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetOwnedCom($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT elggusers.ident,username,name,icon from elggusers,elggfriends where elggfriends.friend = elggusers.ident   and elggfriends.owner=$args and elggusers.user_type=\"community\" and elggusers.owner= $args";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->userid = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->name = $row[2];	 	 $list[$i]->icon = "http://www.mypage.com/_icon/user/".$row[3];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetBlogsUser($args) {    if ($args[1]>0){    $cont = "LIMIT {$args[1]}";    }else {     $cont = "";    }   $i=0;   $list = array();   $this->connect();   $query = "Select ident,owner,weblog,icon,posted,title,body from elggweblog_posts   where weblog = {$args[0]} order by ident DESC {$cont}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->owner = $row[1];	 	 $list[$i]->weblog = $row[2];	 	 $list[$i]->icon = $row[3];	 	 $list[$i]->dateposted = date('F j, Y',$row[4]);	 	 $list[$i]->title = $row[5];	 	 $list[$i]->body = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function AddBlogs($args) {          $owner   =  $args[0];	        $weblog  =  $args[1];	        $icon    =  $args[2];	        $posted  =  $args[3];	        $title   =  $args[4];	        $body    =  $args[5];	        $this->connect();	        $query = "Insert into elggweblog_posts (owner,weblog,icon,posted,title,body)            values (\"$owner\",\"$weblog\",\"$icon\",\"$posted\",\"$title\",\"$body\")";	        $this->query($query);	        $this->disconnect(); }function GetPopularImages($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_userNameFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_entityType = \"GalleryPhotoItem\" ORDER BY g_viewCount DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];     $list[$i]->username = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetComMembers($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT elggusers.ident,username,name,icon from elggusers,elggfriends where elggfriends.friend = elggusers.ident   and elggfriends.owner=$args and elggusers.user_type=\"person\"";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->userid = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->name = $row[2];	 	 $list[$i]->icon = "http://www.mypage.com/_icon/user/".$row[3];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetTags($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT g_tagName FROM `g3_TagMap` ORDER BY RAND() LIMIT {$args}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->g_tagName = $row[0];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetDateJoined($args) {   $this->connect();   $query = "Select `date` as field from  `dir2__link` where uid = {$args}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $field  = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $field; }function GetComMembers2($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT elggusers.ident,username,name,icon from elggusers,elggfriends where elggfriends.friend = elggusers.ident   and elggfriends.owner=$args[0] and elggusers.user_type=\"person\" LIMIT $args[1]";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->userid = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->name = $row[2];	 	 $list[$i]->icon = "http://www.mypage.com/_icon/user/".$row[3];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetFeedsByUser($args){   $i=0;   $list = array();   $this->connect();   $query = " SELECT elggfeeds.ident, elggfeeds.name, elggfeeds.tagline, elggfeed_posts.added, elggfeed_posts.title, elggfeed_posts.body,elggfeed_posts.urlFROM `elggfeed_subscriptions` , `elggfeeds` , elggfeed_postsWHERE elggfeed_subscriptions.feed_id = elggfeeds.identAND elggfeeds.ident = elggfeed_posts.feedAND elggfeed_subscriptions.user_id ={$args[0]}ORDER BY added DESCLIMIT {$args[1]} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->feedid = $row[0];	 	 $list[$i]->feedname = $row[1];	 	 $list[$i]->feedtag = $row[2];	 	 $list[$i]->feedadded =  date("F d, Y ", $row[3]);	 	 $list[$i]->feedtitle = $row[4];	 	 $list[$i]->feedbody = $row[5];	 	 $list[$i]->feedurl = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetFeedsByTopicUser($args){   $i=0;   $list = array();   $this->connect();   $query = " SELECT elggfeeds.ident, elggfeeds.name, elggfeeds.tagline, elggfeed_posts.added, elggfeed_posts.title, elggfeed_posts.body, elggfeed_posts.url    FROM `elggfeed_subscriptions` , `elggfeeds` , elggfeed_postsWHERE elggfeed_subscriptions.feed_id = elggfeeds.identAND elggfeeds.ident = elggfeed_posts.feedAND elggfeed_subscriptions.user_id ={$args[0]}AND (elggfeeds.name like '%$args[1]%' or elggfeeds.url like '%$args[1]%' or elggfeeds.tagline like '%$args[1]%' or elggfeed_posts.title like '%$args[1]%'or elggfeed_posts.body like '%$args[1]%')ORDER BY added DESCLIMIT {$args[2]} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->feedid = $row[0];	 	 $list[$i]->feedname = $row[1];	 	 $list[$i]->feedtag = $row[2];	 	 $list[$i]->feedadded =  date("F d, Y ", $row[3]);	 	 $list[$i]->feedtitle = $row[4];	 	 $list[$i]->feedbody = $row[5];         $list[$i]->feedurl = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetMainCategory(){   $i=0;   $list = array();   $this->connect();   $query = "SELECT id,name FROM `dir2__category` where root = 0  order by name ASC";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->catid = $row[0];	 	 $list[$i]->catname = $row[1];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetSubCategory($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT id,name FROM `dir2__category` where root = {$args} order by name ASC LIMIT 30";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->catid = $row[0];	 	 $list[$i]->catname = $row[1];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetProfLinksByCat($args){   $i=0;   $list = array();   $this->connect();   $query = "SELECT url,description FROM `dir2__link` where category = {$args} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->profurl = $row[0];	 	 $list[$i]->profdesc = $row[1];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}function GetFeedsByTopic($args){   $i=0;   $list = array();   $this->connect();   $query = " SELECT distinct elggfeeds.ident, elggfeeds.name, elggfeeds.tagline, elggfeed_posts.added, elggfeed_posts.title, elggfeed_posts.body, elggfeed_posts.urlFROM `elggfeed_subscriptions` , `elggfeeds` , elggfeed_postsWHERE elggfeed_subscriptions.feed_id = elggfeeds.identAND elggfeeds.ident = elggfeed_posts.feedAND (elggfeeds.name like '%$args[0]%' or elggfeeds.url like '%$args[0]%' or elggfeeds.tagline like '%$args[0]%' or elggfeed_posts.title like '%$args[0]%'or elggfeed_posts.body like '%$args[0]%')ORDER BY added DESCLIMIT {$args[1]}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->feedid = $row[0];	 	 $list[$i]->feedname = $row[1];	 	 $list[$i]->feedtag = $row[2];	 	 $list[$i]->feedadded =  date("F d, Y ", $row[3]);	 	 $list[$i]->feedtitle = $row[4];	 	 $list[$i]->feedbody = $row[5];	 	 $list[$i]->feedurl = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list;}//get image user per keyword function GetImagesKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description            FROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`            WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_id            AND `g3_Item`.g_ownerId = `g3_User`.g_id            AND `g3_FileSystemEntity`.g_id = `g3_Item`.g_id            AND `g3_Entity`.g_id = `g3_Item`.g_id            AND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemId            AND g_userName LIKE \"{$args[0]}\" AND             (g_title LIKE '%$args[1]%' OR g_description LIKE '%$args[1]%' OR g_pathComponent LIKE '%$args[1]%') AND g_entityType = \"GalleryPhotoItem\" ORDER BY `g3_Item`.g_id DESC LIMIT {$args[2]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBlogsKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,owner,weblog,icon,posted,title,body from elggweblog_posts   where title LIKE '%$args[0]%' OR body LIKE '%$args[0]%' order by ident DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->owner = $row[1];	 	 $list[$i]->weblog = $row[2];	 	 $list[$i]->icon = $row[3];	 	 $list[$i]->dateposted = $row[4];	 	 $list[$i]->title = $row[5];	 	 $list[$i]->body = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetVideosPopular($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_userName,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_entityType = \"GalleryMovieItem\" ORDER BY g_viewCount DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->username = $row[6];	 	 $list[$i]->path = $row[7];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetMusicUser($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_userName LIKE \"{$args[0]}\" AND g_renderer LIKE \"MP3AudioRenderer\"  ORDER BY `g3_Item`.g_id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->path = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetMusicLatest($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_renderer LIKE \"MP3AudioRenderer\"  ORDER BY `g3_Item`.g_id DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->path = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetVideosKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_userName LIKE \"{$args[0]}\"AND (g_title LIKE '%$args[1]%' OR g_description LIKE '%$args[1]%' OR g_pathComponent LIKE '%$args[1]%') AND g_entityType = \"GalleryMovieItem\" ORDER BY `g3_Item`.g_id DESC LIMIT {$args[2]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	  $list[$i]->path = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBlogsLatest($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,owner,weblog,icon,posted,title,body from elggweblog_posts FROM order by ident DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	$list[$i]->ident = $row[0];	 	 $list[$i]->owner = $row[1];	 	 $list[$i]->weblog = $row[2];	 	 $list[$i]->icon = $row[3];	 	 $list[$i]->dateposted = $row[4];	 	 $list[$i]->title = $row[5];	 	 $list[$i]->body = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetMusicKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND (g_title LIKE '%$args[0]%' OR g_description LIKE '%$args[0]%' OR g_pathComponent LIKE '%$args[0]%') AND g_renderer LIKE \"MP3AudioRenderer\"  ORDER BY `g3_Item`.g_id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->path = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBlogsUp($args) {   $this->connect();   $query = "SELECT Count(*) as count FROM `elggweblog_report` where weblog_post = {$args} and name = \"votes\"";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $value = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $value; }function GetBlogsDown($args) {   $this->connect();   $query = "SELECT Count(*) as count FROM `elggweblog_report` where weblog_post = {$args} and name = \"downs\"";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $value = $row[0];	 }	 $this->clean();	 $this->disconnect();	 return $value; }function GetBlogsPopular($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT elggweblog_posts.ident, owner,weblog,icon,posted,title,body, weblog_post,Count(*) as count from elggweblog_report,elggweblog_posts where elggweblog_report.weblog_post=elggweblog_posts.ident and name=\"votes\" group by weblog_post order by count desc LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	$list[$i]->ident = $row[0];	 	 $list[$i]->owner = $row[1];	 	 $list[$i]->weblog = $row[2];	 	 $list[$i]->icon = $row[3];	 	 $list[$i]->dateposted = $row[4];	 	 $list[$i]->title = $row[5];	 	 $list[$i]->body = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBookmarksLatest($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT distinct elggbookmarks.ident AS ident,elggbookmarks.url AS url,elggbookmarks.firstowner AS owner,elggbookmarks.no_ticks AS ticks, elggbookmark_subscriptions.description AS description,elggbookmark_subscriptions.ident AS subsid,elggbookmark_subscriptions.title AS title FROM elggbookmarks,elggbookmark_subscriptions,elggtags where elggbookmark_subscriptions.bookmark_id = elggbookmarks.ident and elggbookmark_subscriptions.ident = elggtags.ref and elggtags.tagtype = 'bookmark' AND elggtags.access = 'PUBLIC' order BY elggbookmarks.ident DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->url = $row[1];	 	 $list[$i]->owner = $row[2];	 	 $list[$i]->ticks = $row[3];	 	 $list[$i]->description = $row[4];	 	 $list[$i]->subid = $row[5];	 	 $list[$i]->title = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBookmarksPopular($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT distinct elggbookmarks.ident AS ident,elggbookmarks.url AS url,elggbookmarks.firstowner AS owner,elggbookmarks.no_ticks AS ticks, elggbookmark_subscriptions.description AS description,elggbookmark_subscriptions.ident AS subsid,elggbookmark_subscriptions.title AS title FROM elggbookmarks,elggbookmark_subscriptions,elggtags where elggbookmark_subscriptions.bookmark_id = elggbookmarks.ident and elggbookmark_subscriptions.ident = elggtags.ref and elggtags.tagtype = 'bookmark' AND elggtags.access = 'PUBLIC' order BY elggbookmarks.no_ticks DESC LIMIT {$args}";     $this->query($query);     while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->url = $row[1];	 	 $list[$i]->owner = $row[2];	 	 $list[$i]->ticks = $row[3];	 	 $list[$i]->description = $row[4];	 	 $list[$i]->subid = $row[5];	 	 $list[$i]->title = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBookmarksKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT distinct elggbookmarks.ident AS ident,elggbookmarks.url AS url,elggbookmarks.firstowner AS owner,elggbookmarks.no_ticks AS ticks, elggbookmark_subscriptions.description AS description,elggbookmark_subscriptions.ident AS subsid,elggbookmark_subscriptions.title AS title FROM elggbookmarks,elggbookmark_subscriptions,elggtags where elggbookmark_subscriptions.bookmark_id = elggbookmarks.ident and elggbookmark_subscriptions.ident = elggtags.ref and elggtags.tagtype = 'bookmark' AND elggtags.access = 'PUBLIC' AND (elggtags.tag like '%".$args[0]."%' or elggbookmark_subscriptions.description like '%".$args[0]."%' or elggbookmark_subscriptions.title like '%".$args[0]."%') order BY elggbookmarks.ident DESC LIMIT {$args[1]}";     $this->query($query);     while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->url = $row[1];	 	 $list[$i]->owner = $row[2];	 	 $list[$i]->ticks = $row[3];	 	 $list[$i]->description = $row[4];	 	 $list[$i]->subid = $row[5];	 	 $list[$i]->title = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetBookmarksUser($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT distinct elggbookmarks.ident AS ident,elggbookmarks.url AS url,elggbookmarks.firstowner AS owner,elggbookmarks.no_ticks AS ticks, elggbookmark_subscriptions.description AS description,elggbookmark_subscriptions.ident AS subsid,elggbookmark_subscriptions.title AS title FROM elggbookmarks,elggbookmark_subscriptions,elggtags where elggbookmark_subscriptions.bookmark_id = elggbookmarks.ident and elggbookmark_subscriptions.ident = elggtags.ref and elggtags.tagtype = 'bookmark' AND elggtags.access = 'PUBLIC' AND elggbookmarks.firstowner = {$args[0]} order BY elggbookmarks.ident DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->url = $row[1];	 	 $list[$i]->owner = $row[2];	 	 $list[$i]->ticks = $row[3];	 	 $list[$i]->description = $row[4];	 	 $list[$i]->subid = $row[5];	 	 $list[$i]->title = $row[6];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetLatestSurvey($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT id,username,surveylink, title FROM `elggsurveylink` where surveylink NOT LIKE \"\" order by id DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->link = $row[2];	 	 $list[$i]->title = $row[3];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetKeywordSurvey($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT id,username,surveylink, title FROM `elggsurveylink` where title LIKE '%$args[0]%' AND surveylink NOT LIKE \"\" order by id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->link = $row[2];	 	 $list[$i]->title = $row[3];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function GetUserSurvey($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT id,username,surveylink, title FROM `elggsurveylink` where username LIKE \"".$args[0]."\" AND surveylink NOT LIKE \"\" order by id DESC LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->username = $row[1];	 	 $list[$i]->link = $row[2];	 	 $list[$i]->title = $row[3];	 	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetLatestUsers($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,username,name,email,icon from elggusers  where  user_type = \"{$args[0]}\" order by ident DESC LIMIT {$args[1]} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->userid = $row[0];   $list[$i]->username =   $row[1];   $list[$i]->name =   $row[2];	 $list[$i]->email = $row[3];	 $list[$i]->icon  = $row[4];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; } function GetUsersByCat($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,username,elggusers.name,elggusers.email,icon from elggusers, `dir2__link`  where  `dir2__link`.uid = elggusers.ident and  `dir2__link`.category = \"{$args[0]}\" LIMIT {$args[1]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->userid = $row[0];   $list[$i]->username =   $row[1];   $list[$i]->name =   $row[2];	 $list[$i]->email = $row[3];	 $list[$i]->icon  = $row[4];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; } function GetUsersByKeyword($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,username,elggusers.name,elggusers.email,icon from elggusers, `dir2__link`,`dir2__category`   where  `dir2__link`.uid = elggusers.ident and `dir2__category`.id = `dir2__link`.category and  (`dir2__category`.name LIKE '%$args[0]%' OR elggusers.username LIKE '%$args[0]%' OR elggusers.name LIKE '%$args[0]%' OR elggusers.email LIKE '%$args[0]%') and elggusers.user_type = \"{$args[1]}\" LIMIT {$args[2]}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->userid = $row[0];   $list[$i]->username =   $row[1];   $list[$i]->name =   $row[2];	 $list[$i]->email = $row[3];	 $list[$i]->icon  = $row[4];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; } function GetMusicPopular($args) {   $i=0;   $list = array();   $this->connect();   $query = "SELECT `g3_Item`.g_id,g_pathComponent,g_originationTimestamp,g_title,g_serialNumber,g_description,g_userName,g_parentSequenceFROM `g3_ChildEntity` , `g3_Item` , `g3_User` , `g3_FileSystemEntity` , `g3_Entity` , `g3_ItemAttributesMap`WHERE `g3_ChildEntity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_ownerId = `g3_User`.g_idAND `g3_FileSystemEntity`.g_id = `g3_Item`.g_idAND `g3_Entity`.g_id = `g3_Item`.g_idAND `g3_Item`.g_id = `g3_ItemAttributesMap`.g_itemIdAND g_renderer LIKE \"MP3AudioRenderer\"  ORDER BY g_viewCount DESC LIMIT {$args}";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->itemid = $row[0];	 	 $list[$i]->filename = $row[1];	 	 $list[$i]->timeposted = $row[2];	 	 $list[$i]->title = $row[3];	 	 $list[$i]->serial = $row[4];	 	 $list[$i]->description = $row[5];	 	 $list[$i]->username = $row[6];	 	 $list[$i]->path = $row[7];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetLatestRooms($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select roomname from `ac_rooms` order by updated DESC LIMIT {$args} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->roomname = $row[0];		$i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; } function GetMappers($args) {   $i=0;   $list = array();   $this->connect2();   $this->mytables('mpnet_3pmapr');   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $list[$i]->tablename = $row[0]; 	 $i++;	 }	 $this->clean();	 $this->disconnect();	 return $list; } function GetPortalTheme($args) {   $this->connect();   $query = "Select portalid from elggportal_users where owner = {$args} ";   $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 $field = $row[0]; 	 }	 $this->clean();	 $this->disconnect();	 return $field; } function GetComShout($args) {   $i=0;   $list = array();   $this->connect3();   $query = "SELECT messageid,message,datesent,via FROM `pagemessage`,`textusers` WHERE pagemessage.userid = textusers.userid and username = \"{$args[0]}\" order by messageid DESC LIMIT {$args[1]}";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->messageid = $row[0];	 	 $list[$i]->message = $row[1];	 	 $list[$i]->datesent = $row[2];	 	 $list[$i]->via = $row[3];	 	 $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetConvertDate($args){   $this->connect3();   $query = "Select date_format(datesent, '%b %e %Y %H:%i') as formatted_date from pagemessage where messageid = {$args} ";   $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {    $field = $row[0];    }   $this->clean();	 $this->disconnect();	 return $field; }  function GetPathName($args){   $this->connect();   $query = "SELECT g_pathComponent FROM `g3_FileSystemEntity` WHERE `g_id` = {$args}";   $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {    $field = $row[0];    }   $this->clean();	 $this->disconnect();	 return $field; } function GetProjectsOwn($args){   $i=0;   $list = array();   $this->connect();   $query = "Select ident,type,location,budget,contact_person,contact_number,description,owner,category,   ratings,start_date from elggprojects WHERE `owner` = {$args[0]} LIMIT {$args[1]} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->type = $row[1];	 	 $list[$i]->location = $row[2];	 	 $list[$i]->budget = $row[3];	 	 $list[$i]->contact_person = $row[4];     $list[$i]->contact_number = $row[5];     $list[$i]->description = $row[6];     $list[$i]->owner = $row[7];     $list[$i]->category = $row[8];     $list[$i]->ratings = $row[9];     $list[$i]->start_date = $row[10];	 	 $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetProjectsLatest($args){   $i=0;   $list = array();   $this->connect();   $query = "Select ident,type,location,budget,contact_person,contact_number,description,owner,category,   ratings,start_date from elggprojects order by ident desc LIMIT {$args} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->type = $row[1];	 	 $list[$i]->location = $row[2];	 	 $list[$i]->budget = $row[3];	 	 $list[$i]->contact_person = $row[4];     $list[$i]->contact_number = $row[5];     $list[$i]->description = $row[6];     $list[$i]->owner = $row[7];     $list[$i]->category = $row[8];     $list[$i]->ratings = $row[9];     $list[$i]->start_date = $row[10];	 	 $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetProjectsPop($args){   $i=0;   $list = array();   $this->connect();   $query = "Select ident,type,location,budget,contact_person,contact_number,description,owner,category,   ratings,start_date from elggprojects order by ratings desc LIMIT {$args} ";    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->type = $row[1];	 	 $list[$i]->location = $row[2];	 	 $list[$i]->budget = $row[3];	 	 $list[$i]->contact_person = $row[4];     $list[$i]->contact_number = $row[5];     $list[$i]->description = $row[6];     $list[$i]->owner = $row[7];     $list[$i]->category = $row[8];     $list[$i]->ratings = $row[9];     $list[$i]->start_date = $row[10];	 	 $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function GetBlogsById($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select ident,owner,weblog,icon,posted,title,body from elggweblog_posts   where ident = {$args} ";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->ident = $row[0];	 	 $list[$i]->owner = $row[1];	 	 $list[$i]->weblog = $row[2];	 	 $list[$i]->icon = $row[3];	 	 $list[$i]->dateposted = date('F j, Y',$row[4]);	 	 $list[$i]->title = $row[5];	 	 $list[$i]->body = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function EditBlog($args) {          $ident   =  $args[0];          $posted  =  $args[1];	        $title   =  $args[2];	        $body    =  $args[3];	        $this->connect();	        $query = "Update elggweblog_posts set posted='$posted' ,title='$title',body='$body' where ident = $args[0]";	        $this->query($query);	        $this->disconnect(); }function DeleteBlog($args) {          $this->connect();	        $query = "Delete from elggweblog_posts where ident = {$args}";	        $this->query($query);	        $this->disconnect(); }function AddBookmarks($args) {          $username     =  $args[0];	        $title        =  $args[1];	        $url          =  $args[2];	        $description  =  $args[3];	        $public    =  $args[4];	        $this->connect();	        $query = "Insert into bookmark (user,title,url,description,`date`,public)            values (\"$username\",\"$title\",\"$url\",\"$description\",NOW(),\"1\")";	        $this->query($query);	        $this->disconnect(); }function EditBookmark($args) {          $id   =  $args[0];          $title  =  $args[1];	        $url   =  $args[2];	        $description =  $args[3];	        $public = $args[4];	        $this->connect();	        $query = "Update bookmark set title='$title',url='$url',description='$description',`date` = NOW(),public='$public' where id = $id";	        $this->query($query);	        $this->disconnect(); }function DeleteBookmark($args) {          $this->connect();	        $query = "Delete from bookmark where id = {$args}";	        $this->query($query);	        $this->disconnect(); }function EditProfileData($args) {          $owner = $args[0];          $name = $args[1];          $value = $args[2];          $this->connect();          $query = "Update elggprofile_data set value='$value' where name ='$name' and owner = $owner";	        $this->query($query);	        $this->disconnect(); }function AddProfileData($args) {          $owner = $args[0];          $name = $args[1];          $value = $args[2];          $this->connect();          $query = "Insert into elggprofile_data (owner,name,value) values ('$owner','$name','$value')";	        $this->query($query);	        $this->disconnect(); }function CountRecord($args){       $select = '';    if (!empty($args[1])) {        $select = " WHERE $args[1] = '$args[2]' ";        if (!empty($args[3])) {            $select .= " AND $args[3] = '$args[4]' ";            if (!empty($args[5])) {                $select .= " AND $args[5] = '$args[6]' ";            }        }    }           $this->connect();     $query = "SELECT Count(*) as count from $args[0] ". $select;    $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $numcount = $row[0];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $numcount;  } function GetBookmarksById($args) {   $i=0;   $list = array();   $this->connect();   $query = "Select id,user,title,url,description,public,`date` from bookmark   where id = {$args} ";     $this->query($query);   while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	 $list[$i]->id = $row[0];	 	 $list[$i]->user = $row[1];	 	 $list[$i]->title = $row[2];	 	 $list[$i]->url = $row[3];	 	 $list[$i]->description = $row[4];	 	 $list[$i]->publicval = $row[5];	 	 $list[$i]->date = $row[6];   	$i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; } function AddFeeds($args) {  $url          =  $args[0];	$userid      =  $args[1];	$this->connect();	$query = "Select ident from elggfeeds where url = '$url'";   $this->query($query);  while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	$feedexist = $row[0];	}       if (!empty($feedexist)){  $query = "Insert into elggfeed_subscriptions (feed_id,user_id)   values (\"$feedexist\",\"$userid\")";	$this->query($query);  }else {    $query = "Insert into elggfeeds (url) values (\"$url\")";	        $this->query($query);          $query = "Select ident from elggfeeds where url = '$url' order by ident DESC LIMIT 1";           $this->query($query);          while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	      $feedid = $row[0];	 	   	}              $query = "Insert into elggfeed_subscriptions (feed_id,user_id)           values (\"$feedid\",\"$userid\")";	        $this->query($query);       }	        $this->disconnect(); } function AddForums($args) { $owner = $args[0]; $title = $args[1]; $body = $args[2]; $categoryid = $args[3]; $this->connect(); $query = "Insert into elggforums (owner,title,body,dateposted,categoryid) values ('$owner','$title','$body',NOW(),'$categoryid')"; $this->query($query); $this->disconnect(); } function EditForums($args) {          $ident = $args[0];          $title = $args[1];          $body = $args[2];          $categoryid = $args[3];          $this->connect();          $query = "Update elggforums set title='$title',body='$body',categoryid='$categoryid',dateposted=NOW() where ident = $ident";	        $this->query($query);	        $this->disconnect(); } function GetForumsByUser($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,title,body,dateposted,categoryid from elggforums  where owner = {$args[0]} LIMIT  {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->title = $row[2]; $list[$i]->body = $row[3]; $list[$i]->dateposted = $row[4]; $list[$i]->categoryid = $row[5]; $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }   function GetForumsById($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,title,body,dateposted,categoryid from elggforums  where ident = {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->title = $row[2]; $list[$i]->body = $row[3]; $list[$i]->dateposted = $row[4]; $list[$i]->categoryid = $row[5]; $i++;   	}	 $this->clean();	 $this->disconnect();	 return $list; }function DeleteForum($args) {          $this->connect();	        $query = "Delete from elggforums where ident = {$args}";	        $this->query($query);	        $this->disconnect(); }function GetCommentForum($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,comment,dateposted from elggforums_comments  where forumid = {$args[0]} LIMIT {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->comment = $row[2]; $list[$i]->dateposted = $row[3]; $i++; }	 $this->clean();	 $this->disconnect();	 return $list; }function DeleteForumComments($args) {          $this->connect();	        $query = "Delete from elggforums_comments where ident = {$args}";	        $this->query($query);	        $this->disconnect(); }function AddProjects($args) { $owner = $args[0]; $type = $args[1]; $description = $args[2]; $category = $args[3]; $photo = $args[4]; $this->connect(); $query = "Insert into elggprojects(owner,type,description,category,start_date,end_date) values ('$owner','$type','$description','$category',CURDATE(),CURDATE())"; $this->query($query); if (!empty($args[4])){  $query = "Select ident from elggprojects where type = '$type' and owner='$owner' order by ident DESC LIMIT 1";           $this->query($query);          while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	      $projid = $row[0];	 	   	}  $query = "Insert into elggprojects_photo(proj_id,photo_url,mydefault) values ('$projid','$photo','1')"; $this->query($query); }  $this->disconnect(); } function GetProjectCategories(){ $i=0; $list = array(); $this->connect(); $query = "Select catid,name FROM `dir2__industry` order by name";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->catid = $row[0]; $list[$i]->name  = $row[1]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; } function GetProjectsById($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,type,location,category,contact_person,contact_number,description,notes,start_date,end_date,status,  time_available,reason,budget from elggprojects where ident = $args";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->type = $row[1]; $list[$i]->location  = $row[2]; $list[$i]->category = $row[3]; $list[$i]->contact_person = $row[4]; $list[$i]->contact_number = $row[5]; $list[$i]->description = $row[6]; $list[$i]->notes = $row[7]; $list[$i]->start_date = $row[8]; $list[$i]->end_date = $row[9]; $list[$i]->status = $row[10]; $list[$i]->time_available = $row[11]; $list[$i]->reason = $row[12]; $list[$i]->budget = $row[13]; $i++;}$this->clean();$this->disconnect();return $list;}function EditProjects($args) { $ident = $args[0]; $type = $args[1]; $location  = $args[2]; $category = $args[3]; $contact_person = $args[4]; $contact_number = $args[5]; $description = $args[6]; $notes = $args[7]; $start_date = $args[8]; $end_date = $args[9]; $status = $args[10]; $time_available = $args[11]; $reason = $args[12]; $budget = $args[13]; $this->connect(); $query = "Update elggprojects  set type ='$type',location='$location',category='$category',contact_person='$contact_person',contact_number='$contact_number', description = '$description',notes='$notes',start_date='$start_date',end_date='$end_date',status='$status', time_available='$time_available',reason='$reason',budget='$budget' where ident = $ident"; $this->query($query); $this->disconnect(); } function DeleteProjects($args) {$this->connect();$query = "Delete from elggprojects where ident = {$args}";$this->query($query);$this->disconnect();}  function GetProjReview($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,project_id,posted_by,body,posted from elggprojects_review where project_id = {$args[0]} LIMIT {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->projid  = $row[1]; $list[$i]->postedby = $row[2]; $list[$i]->body = $row[3]; $list[$i]->posted = $row[4]; $i++; }$this->clean();$this->disconnect();	 return $list; }  function DeleteProjReview($args) {$this->connect();$query = "Delete from elggprojects_review where ident = {$args}";$this->query($query);$this->disconnect();}function GetProjPhotos($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,proj_id,photo_url,mydefault from elggprojects_photo where proj_id = {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->projid  = $row[1]; $list[$i]->photourl = $row[2]; $list[$i]->mydefault = $row[3]; $i++; }$this->clean();$this->disconnect();	 return $list; } function AddProjPhoto($args) { $projid = $args[0]; $photo_url = $args[1]; $mydefault = $args[2]; $this->connect(); if ($mydefault=="1"){ $query = "Update elggprojects_photo set  mydefault='0' where mydefault='1' and proj_id='$projid'"; $this->query($query); $query = "Insert into elggprojects_photo  (proj_id,photo_url,mydefault) values ('$projid','$photo_url','$mydefault')"; $this->query($query); }else { $query = "Insert into elggprojects_photo  (proj_id,photo_url,mydefault) values ('$projid','$photo_url','$mydefault')"; $this->query($query); } $this->disconnect(); }function DeleteProjPhoto($args){$this->connect();$query = "Delete from elggprojects_photo where ident = {$args}";$this->query($query);$this->disconnect();}function GetEventsLatest($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,calendar,title,description,access,location,date_start,date_end  FROM elggcalendar_events order by ident DESC LIMIT {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->calendar  = $row[2]; $list[$i]->title  = $row[3]; $list[$i]->description  = $row[4]; $list[$i]->access  = $row[5]; $list[$i]->location  = $row[6]; $list[$i]->date_start  =  strftime("%B %d, %Y",$row[7]); $list[$i]->date_end  =  strftime("%B %d, %Y",$row[8]);  $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; } function GetEventsUser($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,calendar,title,description,access,location,date_start,date_end  FROM elggcalendar_events where calendar={$args[0]} order by ident DESC LIMIT {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->calendar  = $row[2]; $list[$i]->title  = $row[3]; $list[$i]->description  = $row[4]; $list[$i]->access  = $row[5]; $list[$i]->location  = $row[6]; $list[$i]->date_start  =  strftime("%B %d, %Y",$row[7]); $list[$i]->date_end  =  strftime("%B %d, %Y",$row[8]);  $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function AddEvents($args) { $owner = $args[0]; $calendar = $args[1]; $title = $args[2]; $description = $args[3]; $location = $args[4]; $s=explode("-",$args[5]);//month-day-year $date_start = mktime(0, 0, 0, $s[0], $s[1], $s[2]); $e=explode("-",$args[6]);//month-day-year $date_end = mktime(0, 0, 0, $e[0], $e[1], $e[2]); $this->connect(); $query = "Insert into elggcalendar_events  (owner,calendar,title,description,location,date_start,date_end)   values ('$owner','$calendar','$title','$description','$location','$date_start','$date_end')"; $this->query($query); $this->disconnect(); } function GetEventsById($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,owner,calendar,title,description,access,location,date_start,date_end  FROM elggcalendar_events where ident= {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->owner  = $row[1]; $list[$i]->calendar  = $row[2]; $list[$i]->title  = $row[3]; $list[$i]->description  = $row[4]; $list[$i]->access  = $row[5]; $list[$i]->location  = $row[6]; $list[$i]->date_start  = $row[7]; $list[$i]->date_end  =  $row[8]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function EditEvents($args) { $ident = $args[0]; $title = $args[1]; $description = $args[2]; $location = $args[3]; $s=explode("-",$args[4]);//month-day-year $date_start = mktime(0, 0, 0, $s[0], $s[1], $s[2]); $e=explode("-",$args[5]);//month-day-year $date_end = mktime(0, 0, 0, $e[0], $e[1], $e[2]); $this->connect(); $query = "Update elggcalendar_events set title='$title',description='$description',location='$location',date_start='$date_start',date_end='$date_end' where ident = '$ident'"; $this->query($query); $this->disconnect(); }function DeleteEvent($args){$this->connect();$query = "Delete from elggcalendar_events where ident = {$args}";$this->query($query);$this->disconnect();}function GetPlacesLatest($args){ $i=0; $list = array(); $this->connect(); $query = "Select `ident`,`name`,`address`,`description`,`contact`,`posted`,`owner`,`categoryid`,`city`,`countryid` FROM elggplaces LIMIT {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->name  = $row[1]; $list[$i]->address  = $row[2]; $list[$i]->description  = $row[3]; $list[$i]->contact  = $row[4]; $list[$i]->posted  = $row[5]; $list[$i]->owner  = $row[6]; $list[$i]->categoryid  = $row[7]; $list[$i]->city  =  $row[8]; $list[$i]->countryid  =  $row[9]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function GetPlacesByUser($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,name,address,description,contact,posted,owner,categoryid,city,countryid  FROM elggplaces where owner = {$args[0]} order by ident desc limit {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->name  = $row[1]; $list[$i]->address  = $row[2]; $list[$i]->description  = $row[3]; $list[$i]->contact  = $row[4]; $list[$i]->posted  = $row[5]; $list[$i]->owner  = $row[6]; $list[$i]->categoryid  = $row[7]; $list[$i]->city  =  $row[8]; $list[$i]->countryid  =  $row[9]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function GetPlaceCategories(){ $i=0; $list = array(); $this->connect(); $query = "Select ident,name FROM `elggplaces_category` order by name";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->name  = $row[1]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; } function GetPlaceCountries(){ $i=0; $list = array(); $this->connect(); $query = "Select ID,Country FROM elggcountry order by Country";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->country  = $row[1]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function AddPlaces($args) { $owner = $args[0]; $name = $args[1]; $address = $args[2]; $description = $args[3]; $contact = $args[4]; $categoryid = $args[5]; $city = $args[6]; $countryid = $args[7]; $photo = $args[8]; $this->connect(); $query = "Insert into elggplaces  (owner,name,address,description,contact,categoryid,city,countryid,posted)   values ('$owner','$name','$address','$description','$contact','$categoryid','$city','$countryid',NOW())"; $this->query($query); if (!empty($args[8])){  $query = "Select ident from elggplaces where name = '$name' and owner='$owner' order by ident DESC LIMIT 1";           $this->query($query);          while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {	 	      $placeid = $row[0];	 	   	}  $query = "Insert into elggplaces_photo(place_id,url,default_photo) values ('$placeid','$photo','1')"; $this->query($query); } $this->disconnect(); } function EditPlaces($args) { $ident = $args[0]; $name = $args[1]; $address = $args[2]; $description = $args[3]; $contact = $args[4]; $categoryid = $args[5]; $city = $args[6]; $countryid = $args[7]; $this->connect(); $query = "Update elggplaces set name='$name',description='$description',address='$address',contact='$contact',categoryid='$categoryid',city='$city',countryid='$countryid' where ident = '$ident'"; $this->query($query); $this->disconnect(); } function GetPlacesById($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,name,address,description,contact,posted,owner,categoryid,city,countryid  FROM elggplaces where ident = {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->name  = $row[1]; $list[$i]->address  = $row[2]; $list[$i]->description  = $row[3]; $list[$i]->contact  = $row[4]; $list[$i]->posted  = $row[5]; $list[$i]->owner  = $row[6]; $list[$i]->categoryid  = $row[7]; $list[$i]->city  =  $row[8]; $list[$i]->countryid  =  $row[9]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }function AddPlacePhoto($args) { $placeid = $args[0]; $photo = $args[1]; $mydefault = $args[2]; $this->connect(); if ($mydefault=="1"){ $query = "Update elggplaces_photo set  default_photo='0' where default_photo='1' and place_id='$placeid'"; $this->query($query); $query = "Insert into elggplaces_photo  (place_id,url,default_photo) values ('$placeid','$photo','$mydefault')"; $this->query($query); }else { $query = "Insert into elggplaces_photo  (place_id,photo,default_photo) values ('$placeid','$photo','$mydefault')"; $this->query($query); } $this->disconnect(); }function GetPlacePhotos($args){ $i=0; $list = array(); $this->connect(); $query = "Select ident,place_id,url,default_photo from elggplaces_photo where place_id = {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->placeid  = $row[1]; $list[$i]->photourl = $row[2]; $list[$i]->mydefault = $row[3]; $i++; }$this->clean();$this->disconnect();	 return $list; }function DeletePlace($args){$this->connect();$query = "Delete from elggplaces where ident = {$args}";$this->query($query);$this->disconnect();}         function DeletePlacePhoto($args){$this->connect();$query = "Delete from elggplaces_photo where ident = {$args}";$this->query($query);$this->disconnect();}function GetPlacesReview($args) { $i=0; $list = array(); $this->connect(); $query = "Select ident,place_id,postedby,body,dateposted from elggplaces_review where place_id = {$args[0]} LIMIT {$args[1]}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->ident = $row[0]; $list[$i]->placeid  = $row[1]; $list[$i]->postedby = $row[2]; $list[$i]->body = $row[3]; $list[$i]->dateposted = $row[4]; $i++; }$this->clean();$this->disconnect();	 return $list; } function DeletePlaceReview($args){$this->connect();$query = "Delete from elggplaces_review where ident = {$args}";$this->query($query);$this->disconnect();}function GetShopLatest($args){ $i=0; $list = array(); $this->connect(); $query = "Select `itemid`,`addedby`,`name`,`detailed`,`description`,`price`,`added` FROM elggshopitems order by itemid DESC LIMIT {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->itemid = $row[0]; $list[$i]->addedby  = $row[1]; $list[$i]->name  = $row[2]; $list[$i]->detailed  = $row[3]; $list[$i]->description  = $row[4]; $list[$i]->price  = $row[5]; $list[$i]->added  = $row[6];  $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; } function GetShopLatestStores($args){ $i=0; $list = array(); $this->connect(); $query = "Select `id`,`storename`,`tagline`,`description`,`ownerinfo`,`storephone`,`add1`,`add2`,`country`, `google_merchant_id` FROM elggshopsettings order by id DESC LIMIT {$args}";  $this->query($query); while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) { $list[$i]->shopid = $row[0]; $list[$i]->storename  = $row[1]; $list[$i]->tagline  = $row[2]; $list[$i]->description  = $row[3]; $list[$i]->ownerinfo  = $row[4]; $list[$i]->storephone  = $row[5]; $list[$i]->add1  = $row[6]; $list[$i]->add2  = $row[7]; $list[$i]->country  = $row[8]; $list[$i]->google_merchant_id  = $row[9]; $i++;  }	 $this->clean();	 $this->disconnect();	 return $list; }  function RegMpUser($args){ $this->connect(); $password = md5($args[1]); $query = "Insert into elggusers (username,password,name,email) values ('$args[0]','$password','$args[2]','$args[3]')"; $this->query($query); $query = "Select LAST_INSERT_ID() as ident"; $this->query($query);  while ($row = mysql_fetch_array($this->result(),MYSQL_NUM)) {  $id = $row[0];  } $query = "INSERT INTO user (username, password) VALUES ('{$args[0]}','{$password}')"; $this->query($query); $query = "INSERT INTO `ac_users`  (username,password,email,maxlines) VALUES ('{$args[0]}','{$password}','{$args[3]}','10')"; $this->query($query); $query = "INSERT INTO ac_rooms (roomname) VALUES ('{$args[0]}')"; $this->query($query); $this->disconnect(); return $id; }  function UpdateWebpoints($args){ $this->connect(); $query = "Update elggwebpoints set $args[1] = $args[2] where ident = $args[0]"; $this->query($query); $this->disconnect(); }} $db = new DB();?>